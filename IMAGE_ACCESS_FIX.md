# å›¾ç‰‡è®¿é—®é—®é¢˜ä¿®å¤

## ğŸ› é—®é¢˜æè¿°

å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼Œä½†å‰ç«¯æ— æ³•æ˜¾ç¤ºå›¾ç‰‡ã€‚

## ğŸ” åŸå› åˆ†æ

Vite å¼€å‘æœåŠ¡å™¨çš„ä»£ç†é…ç½®åªä»£ç†äº† `/api` è·¯å¾„ï¼Œè€Œå›¾ç‰‡çš„ `/uploads` è·¯å¾„æ²¡æœ‰è¢«ä»£ç†åˆ°åç«¯æœåŠ¡å™¨ï¼ˆ5002ç«¯å£ï¼‰ã€‚

### å‰ç«¯è®¿é—®æµç¨‹
1. å‰ç«¯è¿è¡Œåœ¨ `http://localhost:3000`
2. åç«¯è¿è¡Œåœ¨ `http://localhost:5002`
3. å›¾ç‰‡ URL: `/uploads/events/2025/10/30/20251030_xxx.png`
4. å‰ç«¯å°è¯•è®¿é—®: `http://localhost:3000/uploads/...` âŒï¼ˆ3000ç«¯å£æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶ï¼‰
5. éœ€è¦ä»£ç†åˆ°: `http://localhost:5002/uploads/...` âœ…

## âœ… è§£å†³æ–¹æ¡ˆ

åœ¨ `frontend/vite.config.js` ä¸­æ·»åŠ  `/uploads` è·¯å¾„çš„ä»£ç†é…ç½®ã€‚

### ä¿®æ”¹å‰
```javascript
server: {
  port: 3000,
  proxy: {
    '/api': {
      target: 'http://localhost:5002',
      changeOrigin: true
    }
  }
}
```

### ä¿®æ”¹å
```javascript
server: {
  port: 3000,
  proxy: {
    '/api': {
      target: 'http://localhost:5002',
      changeOrigin: true
    },
    '/uploads': {  // âœ… æ–°å¢
      target: 'http://localhost:5002',
      changeOrigin: true
    }
  }
}
```

## ğŸš€ åº”ç”¨ä¿®å¤

### 1. é‡å¯å‰ç«¯å¼€å‘æœåŠ¡å™¨

ä¿®æ”¹ Vite é…ç½®åï¼Œ**å¿…é¡»é‡å¯**å‰ç«¯æœåŠ¡å™¨ï¼š

```bash
# åœæ­¢å½“å‰è¿è¡Œçš„å‰ç«¯æœåŠ¡ï¼ˆCtrl+Cï¼‰

# é‡æ–°å¯åŠ¨
cd frontend
npm run dev
# æˆ–
yarn dev
```

### 2. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼ˆå¯é€‰ï¼‰

å¦‚æœé‡å¯åä»æœ‰é—®é¢˜ï¼š
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. å³é”®ç‚¹å‡»åˆ·æ–°æŒ‰é’®
3. é€‰æ‹©"æ¸…ç©ºç¼“å­˜å¹¶ç¡¬æ€§é‡æ–°åŠ è½½"

æˆ–è€…ä½¿ç”¨å¿«æ·é”®ï¼š
- Chrome/Edge: `Ctrl + Shift + R` (Windows) / `Cmd + Shift + R` (Mac)
- Firefox: `Ctrl + F5` (Windows) / `Cmd + Shift + R` (Mac)

### 3. éªŒè¯ä¿®å¤

è®¿é—®æ—¥å†é¡µé¢ï¼ŒæŸ¥çœ‹æœ‰èƒŒæ™¯å›¾ç‰‡çš„æ—¥ç¨‹ï¼š
- âœ… å›¾ç‰‡åº”è¯¥èƒ½æ­£å¸¸æ˜¾ç¤º
- âœ… æµè§ˆå™¨æ§åˆ¶å°æ²¡æœ‰ 404 é”™è¯¯
- âœ… Network é¢æ¿æ˜¾ç¤ºå›¾ç‰‡è¯·æ±‚è¿”å› 200

## ğŸ”§ éªŒè¯æ­¥éª¤

### æ–¹æ³•1: æµè§ˆå™¨å¼€å‘è€…å·¥å…·
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. åˆ‡æ¢åˆ° Networkï¼ˆç½‘ç»œï¼‰æ ‡ç­¾
3. åˆ·æ–°é¡µé¢
4. æŸ¥æ‰¾ `/uploads/` å¼€å¤´çš„è¯·æ±‚
5. ç¡®è®¤çŠ¶æ€ç ä¸º **200 OK**

### æ–¹æ³•2: ç›´æ¥è®¿é—®å›¾ç‰‡
åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š
```
http://localhost:3000/uploads/events/2025/10/30/20251030_f7b28f4e34b1.png
```
åº”è¯¥èƒ½çœ‹åˆ°å›¾ç‰‡ã€‚

### æ–¹æ³•3: å‘½ä»¤è¡Œæµ‹è¯•
```bash
# æµ‹è¯•é€šè¿‡ Vite ä»£ç†è®¿é—®
curl -I http://localhost:3000/uploads/events/2025/10/30/20251030_f7b28f4e34b1.png

# åº”è¯¥è¿”å›
HTTP/1.1 200 OK
Content-Type: image/png
```

## ğŸ“‹ ç”Ÿäº§ç¯å¢ƒé…ç½®

### Vite æ„å»ºå
ç”Ÿäº§ç¯å¢ƒä¸éœ€è¦ä»£ç†é…ç½®ï¼Œå› ä¸ºå‰åç«¯é€šå¸¸ï¼š

#### æ–¹æ¡ˆ1: Nginx åå‘ä»£ç†
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /path/to/frontend/dist;
        try_files $uri $uri/ /index.html;
    }
    
    # API è¯·æ±‚ä»£ç†åˆ°åç«¯
    location /api {
        proxy_pass http://localhost:5002;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    # å›¾ç‰‡æ–‡ä»¶ä»£ç†åˆ°åç«¯
    location /uploads {
        proxy_pass http://localhost:5002;
        # æˆ–ç›´æ¥æä¾›é™æ€æ–‡ä»¶
        # alias /path/to/backend/uploads;
    }
}
```

#### æ–¹æ¡ˆ2: å‰åç«¯åŒåŸŸ
å¦‚æœå‰åç«¯éƒ¨ç½²åœ¨åŒä¸€åŸŸåä¸‹ï¼ˆæ¨èï¼‰ï¼š
```
https://your-domain.com/           â†’ å‰ç«¯
https://your-domain.com/api/       â†’ åç«¯ API
https://your-domain.com/uploads/   â†’ åç«¯æ–‡ä»¶
```
æ— éœ€é¢å¤–é…ç½®ï¼Œç›¸å¯¹è·¯å¾„å³å¯æ­£å¸¸è®¿é—®ã€‚

## ğŸ¯ å®Œæ•´æµç¨‹æ€»ç»“

### å¼€å‘ç¯å¢ƒ
```
å‰ç«¯ (localhost:3000)
  â†“ è¯·æ±‚ /uploads/xxx.png
  â†“ Vite ä»£ç†
  â†“ è½¬å‘åˆ° localhost:5002/uploads/xxx.png
åç«¯ (localhost:5002)
  â†“ Flask è·¯ç”±å¤„ç†
  â†“ send_from_directory()
  â†“ è¿”å›æ–‡ä»¶
å‰ç«¯æ˜¾ç¤ºå›¾ç‰‡ âœ…
```

### ç”Ÿäº§ç¯å¢ƒ
```
ç”¨æˆ·æµè§ˆå™¨
  â†“ è¯·æ±‚ https://domain.com/uploads/xxx.png
Nginx
  â†“ location /uploads
  â†“ proxy_pass æˆ– alias
åç«¯/æ–‡ä»¶ç³»ç»Ÿ
  â†“ è¿”å›æ–‡ä»¶
ç”¨æˆ·çœ‹åˆ°å›¾ç‰‡ âœ…
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å¼€å‘ç¯å¢ƒ**: ä¿®æ”¹ `vite.config.js` åå¿…é¡»é‡å¯å‰ç«¯æœåŠ¡
2. **ç«¯å£ä¸€è‡´æ€§**: ç¡®ä¿ä»£ç†ç›®æ ‡ç«¯å£ä¸åç«¯å®é™…ç«¯å£ä¸€è‡´ï¼ˆ5002ï¼‰
3. **è·¯å¾„æ ¼å¼**: æ•°æ®åº“ä¸­å­˜å‚¨çš„ URL åº”è¯¥æ˜¯ç›¸å¯¹è·¯å¾„ `/uploads/...`
4. **CORS**: å¼€å‘ç¯å¢ƒé€šè¿‡ä»£ç†è§£å†³è·¨åŸŸï¼Œç”Ÿäº§ç¯å¢ƒéœ€é…ç½® Nginx æˆ–åç«¯ CORS

## ğŸ§ª æµ‹è¯•æ¸…å•

- [x] å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼ˆæ–‡ä»¶ä¿å­˜åœ¨ `backend/uploads/`ï¼‰
- [x] åç«¯å¯ç›´æ¥è®¿é—®å›¾ç‰‡ï¼ˆ`http://localhost:5002/uploads/...`ï¼‰
- [x] Vite æ·»åŠ äº† `/uploads` ä»£ç†é…ç½®
- [ ] é‡å¯å‰ç«¯å¼€å‘æœåŠ¡å™¨
- [ ] å‰ç«¯å¯ä»¥é€šè¿‡ä»£ç†è®¿é—®å›¾ç‰‡ï¼ˆ`http://localhost:3000/uploads/...`ï¼‰
- [ ] æ—¥å†é¡µé¢å›¾ç‰‡æ­£å¸¸æ˜¾ç¤º
- [ ] æµè§ˆå™¨æ§åˆ¶å°æ—  404 é”™è¯¯

## ğŸ“ ç›¸å…³æ–‡ä»¶

- `frontend/vite.config.js` - Vite ä»£ç†é…ç½® âœ… å·²ä¿®æ”¹
- `backend/app.py` - Flask é™æ€æ–‡ä»¶è·¯ç”±ï¼ˆå·²æ­£ç¡®é…ç½®ï¼‰
- `backend/utils/file_storage.py` - æ–‡ä»¶ä¸Šä¼ é€»è¾‘ï¼ˆå·²æ­£ç¡®é…ç½®ï¼‰

---

## ğŸ‰ ä¿®å¤å®Œæˆ

æŒ‰ç…§ä»¥ä¸Šæ­¥éª¤ï¼š
1. âœ… å·²ä¿®æ”¹ `vite.config.js` æ·»åŠ  `/uploads` ä»£ç†
2. â³ **è¯·é‡å¯å‰ç«¯å¼€å‘æœåŠ¡å™¨**
3. âœ… å›¾ç‰‡åº”è¯¥èƒ½æ­£å¸¸æ˜¾ç¤ºäº†ï¼

å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
- æµè§ˆå™¨æ§åˆ¶å°çš„ Network æ ‡ç­¾ï¼ŒæŸ¥çœ‹å›¾ç‰‡è¯·æ±‚çš„çŠ¶æ€
- åç«¯æ˜¯å¦æ­£å¸¸è¿è¡Œåœ¨ 5002 ç«¯å£
- å›¾ç‰‡æ–‡ä»¶æ˜¯å¦çœŸçš„å­˜åœ¨äº `backend/uploads/` ç›®å½•

